<!DOCTYPE html>
<html lang="en-us" dir="ltr" id="developer-mozilla-org">
<!-- Mirrored from developer.mozilla.org/en/DOM/window.postMessage by HTTrack Website Copier/3.x [XR&CO'2010], Fri, 17 Dec 2010 12:17:42 GMT --><!-- Added by HTTrack --><head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<!-- /Added by HTTrack --><title>window.postMessage - MDC Doc Center</title>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="MSSmartTagsPreventParsing" content="true">
<meta name="ROBOTS" content="ALL">
<meta name="Copyright" content="Copyright (c) 2005-2010 Mozilla.">
<meta name="Rating" content="General">
<link rel="home" href="https://developer.mozilla.org/">
<link rel="copyright" href="#copyright">
<meta name="robots" content="index,follow">
<link rel="shortcut icon" href="../../favicon.ico">
<link rel="alternate" type="application/rss+xml" title="What's new feed" href="https://developer.mozilla.org/index.php?title=Special:Recentchanges&amp;feed=rss">
<link rel="alternate" type="application/rss+xml" title="Page and subpages changes feed" href="https://developer.mozilla.org/index.php?title=Special:Article&amp;type=feed&amp;feedtype=subpagechanges&amp;pageid=15235">
<link rel="alternate" type="application/rss+xml" title="Page changes feed" href="https://developer.mozilla.org/index.php?title=Special:Article&amp;type=feed&amp;pageid=15235">
<meta name="generator" content="MindTouch  9.12.3">
<link rel="search" type="application/opensearchdescription+xml" title="MDC Search" href="https://developer.mozilla.org/deki/gui/opensearch.php?type=description">
<link rel="stylesheet" type="text/css" media="screen" href="../../skins/common/css.css">
<!--[if IE 7]><style type="text/css">@import "/skins/common/_ie7.css";</style><![endif]--><!--[if IE 6]><style type="text/css">@import "/skins/common/_ie.css";</style><![endif]--><link rel="stylesheet" type="text/css" media="print" href="../../skins/common/print.css">
<link rel="stylesheet" type="text/css" media="screen,projection" href="../../skins/mdn/Transitional/css.css">
<!--[if lte IE 7]><link rel="stylesheet" type="text/css" media="all" href="/skins/mdn/Transitional/ie7.css"><![endif]--><!--[if lte IE 6]><link rel="stylesheet" type="text/css" media="all" href="/skins/mdn/Transitional/ie6.css"><![endif]--><link rel="stylesheet" type="text/css" media="print" href="../../skins/mdn/Transitional/print.css">
<script type="text/javascript" src="../../skins/common/js188f.php?perms=LOGIN,BROWSE,READ,SUBSCRIBE"></script><script type="text/javascript">var _starttime = new Date().getTime();</script><!--[if IE]>
<meta http-equiv="imagetoolbar" content="no">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]--><script type="text/javascript">

		Deki.BaseHref = 'https://developer.mozilla.org/';
Deki.PageId = 15235;
Deki.PageTitle = 'en/DOM/window.postMessage';
Deki.PathTpl = '/skins/mdn';
Deki.PathSkin = '/skins/mdn/Transitional';
Deki.PathCommon = '/skins/common';
Deki.UserName = 'Anonymous';
Deki.Today = '17 Dec 2010';
Deki.EditorStyles = [];
Deki.EditorStyles.push('../../skins/mdn/_editor.css');
Deki.EditorStyles.push('../../skins/mdn/Transitional/_content.css');
Deki.EditorStyles.push('../../skins/common/custom_css.css');

		window.onbeforeunload = function() {
			if ( Deki.Editor && Deki.Editor.IsChanged() ) {
				return "You have made changes to the content without saving your changes. Are you sure you want to exit this page?";
			}
		};

		var aLt = new Array();aLt["attach-no-description"] = 'No description'; aLt["cancel"] = 'Cancel'; aLt["close"] = 'Close'; aLt["comment-delete"] = 'Are you sure you want to delete this comment?'; aLt["error"] = 'Error'; aLt["gallery-close"] = 'close'; aLt["gallery-next"] = 'next'; aLt["gallery-prev"] = 'prev'; aLt["internal-error"] = 'Sorry, but there was an internal problem - please try again soon.'; aLt["js-label_cancel"] = 'Cancel'; aLt["js-label_save"] = 'Save'; aLt["js-tooltip_cancel"] = 'Exit Without Saving Changes'; aLt["js-tooltip_save"] = 'Save and Exit (Alt+S)'; aLt["ldap-provide-credentials"] = 'Please provide external service login credentials.'; aLt["loading"] = 'Loading...'; aLt["menu-confirm-delete"] = 'Are you sure you want to delete this file?'; aLt["menu-delete-file"] = 'Delete'; aLt["menu-edit-description"] = 'Edit description'; aLt["menu-move-file"] = 'Move'; aLt["menu-previous-versions"] = 'Previous versions'; aLt["menu-view-original"] = 'View original'; aLt["print-end-notes"] = 'Endnotes'; aLt["ready"] = 'Ready'; aLt["remove-tag"] = 'Remove tag'; aLt["restore-tag"] = 'Restore tag'; aLt["save"] = 'Save'; aLt["submit"] = 'Submit'; aLt["wikibits-attach-another"] = 'Attach another file'; aLt["wikibits-attach-file"] = 'Attach File'; aLt["wikibits-cant-attach-editing"] = 'Sorry, you can\'t attach files while editing a page. Please close the editor first.'; aLt["wikibits-edit-section"] = 'Edit section'; aLt["wikibits-remove-file"] = 'Remove file';  var wfMsg = function (key) { return aLt[key] ? aLt[key] : 'MISSING: ' + key; };
	//hook in menu clicking events to the document's body
	YAHOO.util.Event.addListener(document, "click", function () { DWMenu.BodyClick(); });
	YAHOO.util.Event.onDOMReady(function () { new clientWindow });

			

			YAHOO.util.Event.onDOMReady(function() {
			tb_init("a.lightbox, area.lightbox, input.lightbox, a[rel='awesomebox']");//pass where to apply thickbox
			imgLoader = new Image();// preload image
			imgLoader.src = tb_pathToImage;
		});

		YAHOO.util.Event.onDOMReady(function() {
			MTComments.HookBehavior();
		});
		</script><link type="text/css" rel="stylesheet" href="../../deki/scripts/res/syntax/SyntaxHighlighter.css">
<script type="text/javascript" src="../../deki/scripts/res/syntax/shCore.js"></script><script type="text/javascript" src="../../deki/scripts/res/syntax/shBrushJScript.js"></script><link href="../../skins/common/custom_css.css" rel="stylesheet" type="text/css">
</head>
<div class="wrap">
  <div id="content-main" class="full">

    
        
    <article class="article PageDW-enDOMwindowpostMessage" role="main"><div class="page-title hideforedit">
            
              <h1 class="first" id="title">window.postMessage</h1>      
              </div>
      
    <div class="page-content boxed">

     
      
    
            
      <div id="page-top">
<div id="pageToc"><div class="pageToc">
<h5>Table of contents</h5>
<ol style="list-style-type:none; margin-left:0px; padding-left:0px;">
<li>
<span>1.</span> <a href="#Summary" rel="internal">Summary</a>
</li>
<li>
<span>2.</span> <a href="#Syntax" rel="internal">Syntax</a>
</li>
<li>
<span>3.</span> <a href="#The_dispatched_event" rel="internal">The dispatched event</a>
</li>
<li>
<span>4.</span> <a href="#Security_concerns" rel="internal">Security concerns</a>
</li>
<li>
<span>5.</span> <a href="#Example" rel="internal">Example</a>
</li>
<li>
<span>6.</span> <a href="#Notes" rel="internal">Notes</a>
</li>
<li>
<span>7.</span> <a href="#Specification" rel="internal">Specification</a>
</li>
<li>
<span>8.</span> <a href="#See_also" rel="internal">See also</a>
</li>
</ol>
</div></div>
<div class="pageText" id="pageText">
<p><span class="lang lang-en">Â« <a rel="internal" href="../Gecko_DOM_Reference.html">Gecko DOM Reference</a> </span> <span class="lang lang-en">
<div class="geckoMinversionHeaderTemplate" style="border:solid 1px maroon; overflow:hidden; margin: 10px 0px; padding: 0px 10px; background-color: rgb(254, 244, 156); font-weight: bold; text-align: center;">
<p style="margin: 4px 0px;">Introduced in Gecko 1.9</p>

(Firefox 3)
</div>
</span>  
</p>
<div style="overflow:hidden; margin: 10px 0px; padding: 0px 10px; background-color: rgb(254, 244, 156); font-weight: bold; text-align: center;"><p style="margin: 4px 0px;">This content covers features introduced in <a rel="custom nofollow" href="https://developer.mozilla.org/en/Firefox_3_for_developers">Firefox 3</a>.</p></div>
<p><code>window.postMessage</code> is a method for safely enabling cross-origin communication. Normally, scripts on different pages are only allowed to access each other if and only if the pages which executed them are at locations with the same protocol (usually both <code>http</code>), port number (<code>80</code> being the default for <code>http</code>), and host (modulo <a rel="internal" href="document-25.html">document.domain</a> being set by both pages to the same value). <code>window.postMessage</code> provides a controlled mechanism to circumvent this restriction in a way which is secure when properly used.</p>
<div id="section_1">
<span id="Summary"></span><h3 class="editable">Summary</h3>
<p><code>window.postMessage</code>, when called, causes a <a rel="internal" href="https://developer.mozilla.org/en/MessageEvent" class="new ">MessageEvent</a> to be dispatched at the target window when any pending script that must be executed completes (e.g. remaining event handlers if <code>window.postMessage</code> is called from an event handler, previously-set pending timeouts, etc.). The <a rel="internal" href="https://developer.mozilla.org/en/MessageEvent" class="new ">MessageEvent</a> has the type <code>message</code>, a <code>data</code> property which is set to the string value of the first argument provided to <code>window.postMessage</code>, an <code>origin</code> property corresponding to the origin of the main document in the window calling <code>window.postMessage</code> at the time <code>window.postMessage</code> was called, and a <code>source</code> property which is the window from which <code>window.postMessage</code> is called. (Other standard properties of events are present with their expected values.)</p>
</div>
<div id="section_2">
<span id="Syntax"></span><h3 class="editable">Syntax</h3>
<pre class="eval">
otherWindow.postMessage(message, targetOrigin);
</pre>
<dl>
<dt><code>otherWindow</code></dt> <dd>A reference to another window; such a reference may be obtained, for example, using the <code>contentWindow</code> property of an <code>iframe</code> element, the object returned by <a rel="internal" href="window-77.html">window.open</a>, or by named or numeric index on <a rel="internal" href="window-18.html">window.frames</a>.</dd> <dt><code>message</code></dt> <dd>String data to be sent to the other window.</dd> <dt><code>targetOrigin</code></dt> <dd>Specifies what the origin of <code>otherWindow</code> must be for the event to be dispatched, either as the literal string <code>"*"</code> (indicating no preference) or as a URI. If at the time the event is scheduled to be dispatched the scheme, hostname, or port of <code>otherWindow</code>'s document does not match that provided in <code>targetOrigin</code>, the event will not be dispatched; only if all three match will the event be dispatched. This mechanism provides control over where messages are sent; for example, if <code>postMessage</code> were used to transmit a password, it would be absolutely critical that this argument be a URI whose origin is the same as the intended receiver of the message containing the password, to prevent interception of the password by a malicious third party. <strong>Always provide a specific <code>targetOrigin</code>, not <code>*</code>, if you know where the other window's document should be located. Failing to provide a specific target discloses the data you send to any interested malicious site.</strong>
</dd>
</dl>
</div>
<div id="section_3">
<span id="The_dispatched_event"></span><h3 class="editable">The dispatched event</h3>
<p><code>otherWindow</code> can listen for dispatched messages by executing the following JavaScript:</p>

          <pre name="code" class="js">window.addEventListener("message", receiveMessage, false);

function receiveMessage(event)
{
  if (event.origin !== "http://example.org:8080")
    return;

  // ...
}</pre>
        
<p>The properties of the dispatched message are:</p>
<dl>
<dt><code>data</code></dt> <dd>A string holding the message passed from the other window.</dd> <dt><code>origin</code></dt> <dd>The <a rel="internal" href="https://developer.mozilla.org/en/Origin" class="new ">origin</a> of the window that sent the message at the time <code>postMessage</code> was called. This string is the concatenation of the protocol and "://", the host name if one exists, and ":" followed by a port number if a port is present and differs from the default port for the given protocol. Examples of typical origins are <code>https://example.org</code> (implying port <code>443</code>), <code>http://example.net</code> (implying port <code>80</code>), and <code>http://example.com:8080</code>. Note that this origin is <em>not</em> guaranteed to be the current or future origin of that window, which might have been navigated to a different location since <code>postMessage</code> was called.</dd> <dt><code>source</code></dt> <dd>A reference to the <code><a rel="internal" href="window.html">window</a></code> object that sent the message; you can use this to establish two-way communication between two windows with different origins.</dd>
</dl>
</div>
<div id="section_4">
<span id="Security_concerns"></span><h3 class="editable">Security concerns</h3>
<p><strong>If you do not expect to receive messages from other sites, <em>do not</em> add any event listeners for <code>message</code> events.</strong> This is a completely foolproof way to avoid security problems.</p>
<p>If you do expect to receive messages from other sites, <strong>always verify the sender's identity</strong> using the <code>origin</code> and possibly <code>source</code> properties. Any window (including, for example, <code>http://evil.example.com</code>) can send a message to any other window, and you have no guarantees that an unknown sender will not send malicious messages. Having verified identity, however, you still should <strong>always verify the syntax of the received message</strong>. Otherwise, a security hole in the site you trusted to send only trusted messages could then open a cross-site scripting hole in your site.</p>
<p><strong>Always specify an exact target origin, not <code>*</code>, when you use <code>postMessage</code> to send data to other windows.</strong>Â A malicious site can change the location of the window without your knowledge, and therefore it can intercept the data sent using <code>postMessage</code>.</p>
</div>
<div id="section_5">
<span id="Example"></span><h3 class="editable">Example</h3>

          <pre name="code" class="js">/*
 * In window A's scripts, with A being on &lt;http://example.com:8080&gt;:
 */

var popup = window.open(...popup details...);

// When the popup has fully loaded, if not blocked by a popup blocker:

// This does nothing, assuming the window hasn't changed its location.
popup.postMessage("The user is 'bob' and the password is 'secret'",
                  "https://secure.example.net");

// This will successfully queue a message to be sent to the popup, assuming
// the window hasn't changed its location.
popup.postMessage("hello there!", "http://example.org");

function receiveMessage(event)
{
  // Do we trust the sender of this message?  (might be
  // different from what we originally opened, for example).
  if (event.origin !== "http://example.org")
    return;

  // event.source is popup
  // event.data is "hi there yourself!  the secret response is: rheeeeet!"
}
window.addEventListener("message", receiveMessage, false);</pre>
        

          <pre name="code" class="js">/*
 * In the popup's scripts, running on &lt;http://example.org&gt;:
 */

// Called sometime after postMessage is called
function receiveMessage(event)
{
  // Do we trust the sender of this message?
  if (event.origin !== "http://example.com:8080")
    return;

  // event.source is window.opener
  // event.data is "hello there!"

  // Assuming you've verified the origin of the received message (which
  // you must do in any case), a convenient idiom for replying to a
  // message is to call postMessage on event.source and provide
  // event.origin as the targetOrigin.
  event.source.postMessage("hi there yourself!  the secret response " +
                           "is: rheeeeet!",
                           event.origin);
}

window.addEventListener("message", receiveMessage, false);</pre>
        
</div>
<div id="section_6">
<span id="Notes"></span><h3 class="editable">Notes</h3>
<p>Any window may access this method on any other window, at any time, regardless of the location of the document in the window, to send it a message. Consequently, any event listener used to receive messages <strong>must</strong> first check the identity of the sender of the message, using the <code>origin</code> and possibly <code>source</code> properties. This cannot be understated: <strong>Failure to check the <code>origin</code> and possibly <code>source</code> properties enables cross-site scripting attacks.</strong></p>
<p>As with any asynchronously-dispatched script (timeouts, user-generated events), it is not possible for the caller of <code>postMessage</code> to detect when an event handler listening for events sent by <code>postMessage</code> throws an exception.</p>
<p>The value of the <code>origin</code> property of the dispatched event is not affected by the current value of <code>document.domain</code> in the calling window.</p>
<p>For IDN host names only, the value of the <code>origin</code> property is not consistently Unicode or punycode; for greatest compatibility check for both the IDN and punycode values when using this property if you expect messages from IDN sites. This value will eventually be consistently IDN, but for now you should handle both IDN and punycode forms.</p>
<p>The value of the <code>origin</code> property when the sending window contains a <code>javascript:</code> or <code>data:</code> URL is the origin of the script that loaded the URL.</p>
<p><span class="lang lang-en"><span class="nonStandardInlineTemplate" style="border: 1px solid rgb(255, 213, 153); background-color: rgb(255, 239, 217); font-size: x-small; white-space: nowrap; padding: 2px;">Non-standard</span></span>      <code>window.postMessage</code> is available to JavaScript running in chrome code (e.g. in extensions and privileged code), but the <code>source</code> property of the dispatched event is always <code>null</code> as a security restriction. (The other properties have their expected values.) The <code>targetOrigin</code> argument for a message sent to a window located at a <code>chrome:</code> URL is currently misinterpreted such that the only value which will result in a message being sent is <code>"*"</code>. Since this value is unsafe when the target window can be navigated elsewhere by a malicious site, it is recommended that <code>postMessage</code> not be used to communicate with <code>chrome:</code> pages for now; use a different method (such as a query string when the window is opened) to communicate with chrome windows. Lastly, posting a message to a page at a <code>file:</code> URL currently requires that the <code>targetOrigin</code> argument be <code>"*"</code>. <code>file://</code> cannot be used as a security restriction; this restriction may be modified in the future.</p>
</div>
<div id="section_7">
<span id="Specification"></span><h3 class="editable">Specification</h3>
<p><code>window.postMessage</code> is defined by the <a class="external" rel="external nofollow" href="http://www.whatwg.org/specs/web-apps/current-work/multipage/section-crossDocumentMessages.html#crossDocumentMessages" title="http://www.whatwg.org/specs/web-apps/current-work/multipage/section-crossDocumentMessages.html#crossDocumentMessages" target="_blank">draft HTML5 specification</a>.</p>
</div>
<div id="section_8">
<span id="See_also"></span><h3 class="editable">See also</h3>
<p><a rel="internal" href="document-25.html">document.domain</a></p> <p></p>
</div>
</div>
</div>
<div class="printfooter" id="printfooter">
<hr>
<p>Retrieved from "<a href="window-79.html">https://developer.mozilla.org/en/DOM/window.postMessage</a>"</p>
</div>

            </div>

    </article>

  </div>
<!-- /#content-main -->

</div>
<!-- /.wrap -->
<!-- Mirrored from developer.mozilla.org/en/DOM/window.postMessage by HTTrack Website Copier/3.x [XR&CO'2010], Fri, 17 Dec 2010 12:17:42 GMT --><!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8">
<!-- /Added by HTTrack -->
</html>
